define("feature/file-content/binary-diff-view",["jquery","util/deprecation","util/events","model/file-change","feature/file-content/binary-view","feature/file-content/image-diff-toolbar","feature/file-content/image-differ"],function(F,D,B,E,C,A,G){function H(J,I){this._init(J,I)}H.prototype._init=function(M,K){var I=new E(K.fileChange).getCommitRange();var J=I.getUntilRevision();var L=I.getSinceRevision();this._$container=F(stash.feature.fileContent.binaryView.container()).appendTo(K.$container);this._populateBinaryInfo(M,L,J);this._renderBinaryDiff();B.trigger("stash.feature.fileContent.onBinaryDiffShown",null,{containerEl:this._$container.get(0),sourcePath:M.source,sourceType:this._sinceResult&&this._sinceResult.type,sinceRevision:L&&L.toJSON(),destinationPath:M.destination,destinationType:this._untilResult&&this._untilResult.type,untilRevision:J&&J.toJSON()});D.triggerDeprecated("stash.feature.diffview.onBinary",this,{$container:this._$container,sourcePath:M.source,sourceType:this._sinceResult&&this._sinceResult.type,sinceRevision:L,destinationPath:M.destination,destinationType:this._untilResult&&this._untilResult.type,untilRevision:J},"stash.feature.fileContent.diff.onShow","2.11","3.0")};H.prototype._populateBinaryInfo=function(M,K,J){var L=M.source;var I=M.destination;if(L&&K){this._sinceResult=C.getRenderedBinary(L,K.getId())}if(I&&J){this._untilResult=C.getRenderedBinary(I,J.getId())}};H.prototype._renderBinaryDiff=function(){var J=this._sinceResult&&this._untilResult&&this._sinceResult.type===this._untilResult.type&&this._sinceResult.type==="image";if(J){this._toolbar=new A(this._$container);this._differ=new G(this._$container)}if(this._sinceResult){F(stash.feature.fileContent.binaryView.cell({extraClasses:"since-revision",titleText:stash_i18n("stash.web.diff.since.revision","Old")})).append(this._sinceResult.$elem).appendTo(this._$container)}if(this._untilResult){F(stash.feature.fileContent.binaryView.cell({extraClasses:"until-revision",titleText:stash_i18n("stash.web.diff.until.revision","New")})).append(this._untilResult.$elem).appendTo(this._$container)}if(J){var I=this;this._differ.init().done(function(K){I._toolbar.init(K)});this._toolbar.on("modeChanged",function(K){I._differ.setMode(K)})}};H.prototype.destroy=function(){if(this._toolbar){this._toolbar.destroy();this._toolbar=null}if(this._differ){this._differ.destroy();this._differ=null}if(this._$container){this._$container.remove();this._$container=null}this._sinceResult=null;this._untilResult=null};return H});