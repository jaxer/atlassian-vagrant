define("feature/file-content/diff-view/diff-view-context",["util/deprecation","feature/file-content/diff-view-context"],function(B,A){B.getMessageLogger("feature/file-content/diff-view/diff-view-context","feature/file-content/diff-view-context","2.11","3.0")();return A});define("feature/file-content/diff-view-context",["jquery","underscore","util/ajax","util/dom-event","util/navbuilder","feature/file-content/diff-view-context/diff-view-context-internal","exports"],function(D,J,I,B,K,E,C){var H=navigator.platform.indexOf("Mac")!==-1;var L=H?stash_i18n("stash.web.diffview.showmore.tooltip.cmd","Click to reveal a few more lines\nCmd + Click to reveal them all"):stash_i18n("stash.web.diffview.showmore.tooltip.ctrl","Click to reveal a few more lines\nCtrl + Click to reveal them all");var G=K.parse(location.href).getQueryParamValue("context");var A={maxLimit:D.browser.msie?1000:5000,maxContext:(G&&parseInt(G,10))||10};function F(P,Q,R,M,N,O){return(N||O)?stash.feature.fileContent.hunkSeparator({tooltip:L,lineStart:P,lineEnd:Q,destOffset:R,changeType:M,isBelow:N,isAbove:O}):""}C.attachExpandContext=function(N,M,O){return N.on("click",".skipped-container:not(.loading)",function(S){S.preventDefault();var X=D(S.currentTarget);X.addClass("loading");X.find(".showmore span").html("&nbsp;");var P=X.find(".showmore").spin("small");var W=X.data("change-type");function T(a,Y){var Z=M.getDiff()&&M.getDiff().attributes||{};return I.rest({statusCode:{"200":function(e,b,d,c){if(c&&c.message&&c.message.replace(/,/g,"").indexOf(" "+a+" ")>0){return{promise:function(){return{lines:[]}}}}}},url:K.currentRepo().browse().path((M.getSrcPath()&&M.getSrcPath().toString()!=="")?M.getSrcPath():M.getPath()).at(E.isAdded(W)?Z.toHash||M.getCommitRange().getUntilRevision().getId():Z.fromHash||M.getCommitRange().getSinceRevision().getId()).withParams({start:a,limit:Y}).build()}).then(J.identity).always(function(){P.spinStop()}).fail(function(){X.removeClass("loading")})}var Q=X.data("dest-offset");var U=B.isCtrlish(S)?A.maxLimit-1:A.maxContext;var V=X.data("line-start")-1;var R=X.data("line-end")-1;E.fetchContext(V,R,T,U,A).then(E.toHunks(Q,W)).then(J.bind(O,null,M,X))})};C.getSeparatedHunkHtml=function(N,M){return E.getSeparatedHunkHtml(N,M,F)}});