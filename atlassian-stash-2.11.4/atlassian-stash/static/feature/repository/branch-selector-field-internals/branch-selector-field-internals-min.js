define("feature/repository/branch-selector-field-internals",["jquery","underscore","util/events","model/revision-reference","widget/searchable-selector","feature/repository/revision-reference-selector"],function(D,H,I,A,F,G){var E=[];function B(){var J=[];var K=E.length;while(K--){if(!E[K].$input.closest(document.body).length){E[K].destroy()}else{J.push(E[K])}}E=J}D(document).bind("hideLayer",function(){setTimeout(B,0)});function C(J){if(!J||!H.isArray(J)){return null}H.each(J,function(L){var K=A.type.from(L.type);if(K!=null){L.type=K}});return F.constructDataPageFromPreloadArray(J)}I.on("stash.widget.branchselector.inputAdded",function(K,J){D(document).ready(function(){var M;function L(){M=M.length?M:D("#"+K);if(!M.length){console.log("Branch selector field (#"+K+") was not found and not initialised. See https://jira.atlassian.com/browse/STASH-3914")}var N=M.nextAll(".remove-link");var Q=C(J.preloadData);var P=new G(M.prevAll(".branch-selector-field"),{context:K,field:M,triggerPlaceholder:J.triggerPlaceholder,show:{tags:J.showTags},preloadData:Q,extraClasses:J.extraClasses});if(J.revisionId){var R=Q&&H.findWhere(Q.values,{id:J.revisionId});if(R){P.setSelectedItem(new A({id:R.id,displayId:R.displayId,type:R.type,isDefault:false}))}else{P.setSelectedItem(A.hydrateRefFromId(J.revisionId))}}N.click(function(S){S.preventDefault();P.clearSelection();N.addClass("hidden")});var O=function(S){if(this===P){M.val(S?S.getId():"");if(S.getType().id===A.type.TAG.id){N.text(stash_i18n("stash.web.branch-selector.remove.tag","Remove tag"))}else{N.text(stash_i18n("stash.web.branch-selector.remove.branch","Remove branch"))}N.toggleClass("hidden",!S)}};I.on("stash.feature.repository.revisionReferenceSelector.revisionRefChanged",O);E.push({$input:M,destroy:function(){I.off("stash.feature.repository.revisionReferenceSelector.revisionRefChanged",O);P.destroy();P=null}})}M=D("#"+K);if(M.length){L()}else{H.defer(L)}})})});require("feature/repository/branch-selector-field-internals");