define("feature/repository/branch-table",["aui","jquery","underscore","util/events","util/navbuilder","model/page-state","widget/paged-table"],function(G,C,H,I,A,F,D){function E(J){if(!J){throw new Error("Undefined ref")}else{if(!J.id){throw new Error("Ref without id")}}return J}function B(J,K){D.call(this,C.extend({},B.defaults,J));this._baseRef=E(K)}B.defaults={filterable:true,pageSize:20,noneFoundMessageHtml:G.escapeHtml(stash_i18n("stash.web.repository.branch.table.no.branches","No branches")),noneMatchingMessageHtml:G.escapeHtml(stash_i18n("stash.web.repository.branch.table.no.matches","No branches match")),idForEntity:function(J){return J.id}};C.extend(B.prototype,D.prototype);B.prototype.buildUrl=function(M,J,K){var L={base:this._baseRef.id,details:true,start:M,limit:J,orderBy:"MODIFICATION"};if(K){L.filterText=K}return A.rest().currentRepo().branches().withParams(L).build()};B.prototype.handleNewRows=function(J,K){this.$table.find("tbody")[K](stash.feature.repository.branchRows({branches:J.values,baseRef:this._baseRef,repository:F.getRepository().toJSON()}))};B.prototype.isCurrentBase=function(J){return this._baseRef.id===E(J).id};B.prototype.update=function(K,J){if(K){this._baseRef=E(K)}D.prototype.update.call(this,J)};B.prototype.remove=function(K){if(D.prototype.remove.call(this,K)){var J=this.$table.find('tbody > tr[data-id="'+K.id+'"]');J.fadeOut(H.bind(function(){if(J.hasClass("focused")){var L=J.next();var M=L.length?L:J.prev();if(M.length){M.addClass("focused");M.find("td[headers=branch-name-column] > a").focus()}}J.remove();if(this.loadedRange.reachedStart()&&this.loadedRange.reachedEnd()&&!(this.$table.find("tbody > tr").length)){this.handleNoData()}this.updateTimestamp()},this));return true}return false};B.prototype.initShortcuts=function(){D.prototype.initShortcuts.call(this);var L=this.$table.selector;var J=this.options.focusOptions;var K=L+" "+J.rowSelector;var M=K+"."+J.focusedClass;I.on("stash.keyboard.shortcuts.requestMoveToNextHandler",function(N){(this.moveToNextItem?this:G.whenIType(N)).moveToNextItem(K,J).execute(function(){if(C(K).last().hasClass(J.focusedClass)){window.scrollTo(0,document.documentElement.scrollHeight)}})});I.on("stash.keyboard.shortcuts.requestMoveToPreviousHandler",function(N){(this.moveToPrevItem?this:G.whenIType(N)).moveToPrevItem(K,J)});I.on("stash.keyboard.shortcuts.requestOpenItemHandler",function(N){(this.execute?this:G.whenIType(N)).execute(function(){var O=C(M);if(O.length){location.href=O.find("td[headers=branch-name-column] > a").attr("href")}})});I.on("stash.keyboard.shortcuts.requestOpenItemActionHandler",function(N){(this.execute?this:G.whenIType(N)).execute(function(){var O=C(M);if(O.length){O.find(".branch-list-action-trigger").click()}})})};return B});