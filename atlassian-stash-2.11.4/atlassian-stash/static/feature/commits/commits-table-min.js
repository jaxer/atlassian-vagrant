define("feature/commits/commits-table",["jquery","aui","util/events","widget/paged-table"],function(D,A,B,C){function E(G,F){this.getCommitsUrlBuilder=G;var H={target:"#commits-table",ajaxDataType:"html",tableMessageClass:"commits-table-message",allFetchedMessageHtml:'<p class="no-more-results">'+A.escapeHtml(stash_i18n("stash.web.commits.allcommitsfetched","No more history"))+"</p>",noneFoundMessageHtml:'<h3 class="no-results entity-empty">'+A.escapeHtml(stash_i18n("stash.web.commits.nocommitsfetched","No history found"))+"</h3>"};F=D.extend({},H,F);C.call(this,F);this.$spinner.addClass("commits-table-spinner")}D.extend(E.prototype,C.prototype);E.prototype.buildUrl=function(G,F){return this.getCommitsUrlBuilder().withParams({start:G,limit:F,contents:""}).build()};E.prototype.onDataLoaded=function(H,F,G){if(typeof G==="string"){G=this.createDataFromJQuery(H,F,D(G))}return C.prototype.onDataLoaded.call(this,H,F,G)};E.prototype.attachNewContent=function(G,F){C.prototype.attachNewContent.call(this,G,F);B.trigger("stash.widget.commitsTable.contentAdded",this,G)};E.prototype.handleNewRows=function(G,F){this.$table.show().children("tbody")[F!=="html"?F:"append"](G.values)};E.prototype.focusInitialRow=function(){this.$table.find("tbody tr.commit-row:first").addClass("focused-commit")};E.prototype.initShortcuts=function(){var G=this,J=this.$table.selector,F=false,H={focusedClass:"focused-commit",wrapAround:false,escToCancel:false},K=J+" .commit-row."+H.focusedClass,I=K+", "+J+".show-merges .commit-row, "+J+":not(.show-merges) .commit-row:not(.merge)";this._onDisableOpenItemHandler=function(){F=true};this._onEnableOpenItemHandler=function(){F=false};B.on("stash.keyboard.shortcuts.disableOpenItemHandler",this._onDisableOpenItemHandler);B.on("stash.keyboard.shortcuts.enableOpenItemHandler",this._onEnableOpenItemHandler);this.bindMoveToNextHandler=function(L){(this.moveToNextItem?this:A.whenIType(L)).moveToNextItem(I,H).execute(function(){if(D(I).last().hasClass(H.focusedClass)){window.scrollTo(0,document.documentElement.scrollHeight)}})};this.bindMoveToPreviousHandler=function(L){(this.moveToPrevItem?this:A.whenIType(L)).moveToPrevItem(I,H)};this.bindOpenItemHandler=function(L){(this.execute?this:A.whenIType(L)).execute(function(){if(!F){var M=A.$(K);if(M.length){window.location.href=M.find("td.changeset a").attr("href")}}})};this.bindToggleMergesHandler=function(L){(this.execute?this:A.whenIType(L)).execute(function(){G.$table.toggleClass("show-merges")})};C.prototype.initShortcuts.call(this)};E.prototype.resetShortcuts=function(){C.prototype.resetShortcuts.call(this);B.off("stash.keyboard.shortcuts.disableOpenItemHandler",this._onDisableOpenItemHandler);B.off("stash.keyboard.shortcuts.enableOpenItemHandler",this._onEnableOpenItemHandler)};return E});