define("feature/pull-request/pull-request-table",["jquery","aui","util/events","model/page-state","model/pull-request","widget/paged-table","widget/notifications-center"],function(G,B,D,C,H,E,A){F.defaults={allFetchedMessageHtml:'<p class="no-more-results">'+stash_i18n("stash.web.pull-requests.allfetched","No more pull requests")+"</p>",alwaysDisplayRepositories:false,bufferPixels:150,hideAuthorName:false,scope:"repository",showStatus:false,target:"#pull-requests-table",tableMessageClass:"pull-request-table-message"};function F(N,K,M,L){this.prState=N&&N.toUpperCase();this.prOrder=(K?K:(this.prState===H.state.OPEN?"oldest":"newest"));this.getPullRequestsUrlBuilder=M;this.prDirection=L.direction;this.prSource=L.source;var J={noneFoundMessageHtml:stash.feature.pullRequest.pullRequestTableEmpty({state:this.prState})};L=G.extend(F.defaults,J,L);this.alwaysDisplayRepositories=L.alwaysDisplayRepositories;this.hideAuthorName=L.hideAuthorName;this.scope=L.scope;this.showStatus=L.showStatus;E.call(this,L);var I={hoverable:false,offset:5,delayIn:0,gravity:function(){return G.fn.tipsy.autoNS.call(this)+G.fn.tipsy.autoWE.call(this)},live:true};G(this.options.target).find(".author > div, .author .aui-avatar-inner > img").tooltip(I)}G.extend(F.prototype,E.prototype);F.prototype.buildUrl=function(L,I){var K=this;var J=K.getPullRequestsUrlBuilder().withParams({start:L,limit:I,avatarSize:stash.widget.avatarSizeInPx({size:"medium"})});if(K.prDirection){J=J.withParams({direction:K.prDirection})}if(K.prSource){J=J.withParams({at:K.prSource})}if(K.prState){J=J.withParams({state:K.prState})}if(K.prOrder){J=J.withParams({order:K.prOrder})}return J.build()};F.prototype.focusInitialRow=function(){this.$table.find("tbody tr.pull-request-row:first").addClass("focused")};F.prototype.attachNewContent=function(J,I){E.prototype.attachNewContent.call(this,J,I);D.trigger("stash.feature.pullRequestsTable.contentAdded",this,J)};F.prototype.handleNewRows=function(L,K){var I=this;var J=G(_.map(L.values,function(M){return stash.feature.pullRequest.pullRequestRow({alwaysDisplayRepositories:I.alwaysDisplayRepositories,currentUser:C.getCurrentUser(),hideAuthorName:I.hideAuthorName,pullRequest:M,scope:I.scope,showStatus:I.showStatus})}).join(""));this.$table.show().children("tbody")[K!=="html"?K:"append"](J)};F.prototype.initShortcuts=function(){var K=this;var N=this.$table.selector;var I=false;var L={focusedClass:"focused",wrapAround:false,escToCancel:false};var P=N+" .pull-request-row."+L.focusedClass;var M=P+", "+N+":not(.filter-current-user, .filter-current-user-unactioned) .pull-request-row, "+N+".filter-current-user .pull-request-row.current-user, "+N+".filter-current-user-unactioned .pull-request-row.current-user:not(.current-user-actioned)";D.on("stash.keyboard.shortcuts.disableOpenItemHandler",function(){I=true});D.on("stash.keyboard.shortcuts.enableOpenItemHandler",function(){I=false});this.bindMoveToNextHandler=function(Q){(this.moveToNextItem?this:B.whenIType(Q)).moveToNextItem(M,L).execute(function(){if(G(M).last().hasClass(L.focusedClass)){window.scrollTo(0,document.documentElement.scrollHeight)}})};this.bindMoveToPreviousHandler=function(Q){(this.moveToPrevItem?this:B.whenIType(Q)).moveToPrevItem(M,L)};this.bindOpenItemHandler=function(Q){(this.execute?this:B.whenIType(Q)).execute(function(){if(!I){var R=B.$(P);if(R.length){window.location.href=R.find("td.id a").attr("href")}}})};this.bindHighlightAssignedHandler=function(Q){(this.execute?this:B.whenIType(Q)).execute(function(){J(K.$table)})};var O;function J(R){var S=[{name:"filter-current-user",description:stash_i18n("stash.web.stash.web.pull-requests.filter-current-user","Showing your pull requests")},{name:"filter-current-user-unactioned",description:stash_i18n("stash.web.stash.web.pull-requests.filter-current-user-unactioned","Showing your unactioned pull requests")},{name:"",description:stash_i18n("stash.web.stash.web.pull-requests.filter-all","Showing all pull requests")}];var Q=S.length-1;_.any(S,function(U,T){if(R.hasClass(U.name)||T===Q){var V=(T<Q)?S[T+1]:S[0];R.removeClass(U.name).addClass(V.name);if(O){O.remove()}O=A.showNotification(V.description);return true}return false})}E.prototype.initShortcuts.call(this)};return F});