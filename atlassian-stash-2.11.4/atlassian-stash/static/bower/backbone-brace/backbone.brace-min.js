(function(){var I=this;var K;if(typeof exports!=="undefined"){K=exports}else{K=I.Brace={}}var O=I._;if(!O&&(typeof require!=="undefined")){O=require("underscore")}var N=I.Backbone;if(!N&&(typeof require!=="undefined")){N=require("backbone")}function F(Q){if(O.isArray(Q)){return O.reduce(Q,function(R,S){R[S]=null;return R},{})}return Q}function B(Q,R){if(!Q||R==null){return R}if(typeof Q==="string"||Q instanceof String){if(typeof R!==""+Q){throw"The typeof "+R+" is "+typeof R+" but expected it to be "+Q}return R}if(O.isArray(Q)||Q===Array){if(!L(R)){throw"Array type expected, but nonnull, non-Array value provided."}return Q===Array||!Q[0]?R:O.map(R,O.bind(B,null,Q[0]))}if(typeof Q!=="function"){throw"Invalid expected type "+Q+". Should be falsy, String, Array, Backbone.Collection constructor, or function."}if(R instanceof Q){return R}if(H(Q)){return new Q(B([Q.model],R))}return new Q(R)}function H(R,Q){return R&&(R.__super__ instanceof (Q||N.Collection)||R.__super__===(Q||N.Collection).prototype||R===(Q||N.Collection))}function L(Q){return O.has(Q,"length")&&!(Q instanceof String||O.has({string:1,"function":1},typeof Q)||Q instanceof N.Collection)}function M(S,R){var Q={};O.each(S,function(U,T){if(!R[T]||P(U,R[T])){Q[T]=U}else{if(!U||P(R[T],U)){return }else{throw T+" has conflicted type descriptors."}}});return Q}function P(R,Q){if(!Q||Q===R){return true}if(!R||typeof R==="string"){return false}if(R instanceof Array){return Q===Array||(Q instanceof Array&&P(R[0],Q[0]))}if(typeof Q!=="function"){return false}if(H(Q)){return H(R,Q)}return R.prototype instanceof Q}function E(Q){if(O.isObject(Q)){return O.reduce(Q,function(R,T,S){if(T&&O.isFunction(T.toJSON)){R[S]=T.toJSON()}else{if(O.isArray(T)){R[S]=O.map(T,function(U){if(U&&O.isFunction(U.toJSON)){return U.toJSON()}else{return U}})}}return R},Q)}else{return Q}}function A(R){return function Q(){var S=R.call(this);return E(S)}}K.Mixins={createMethodName:function(Q,R){return Q+R.charAt(0).toUpperCase()+R.substr(1)},applyMixin:function(R,Q){O.forEach(O.keys(Q),function(Z){var W=R.prototype;if("initialize"===Z){var Y=W.initialize;W.initialize=function(){if(Y){Y.apply(this,arguments)}Q.initialize.apply(this,arguments)};return }if("validate"===Z){var S=W.validate;W.validate=function(){if(S){var b=S.apply(this,arguments);if(b){return b}}return Q.validate.apply(this,arguments)};return }if("defaults"===Z){var V=W.defaults||(W.defaults={});var X=Q[Z];for(var U in X){if(V.hasOwnProperty(U)){throw"Mixin error: class already has default '"+U+"' defined"}V[U]=X[U]}return }if("namedAttributes"===Z){var T=F(W.namedAttributes)||{};var a=F(Q[Z]);W.namedAttributes=O.extend(T,M(a,T));return }if("namedEvents"===Z){if(!O.isArray(Q[Z])){throw"Expects events member on mixin to be an array"}if(!W.namedEvents){W.namedEvents=[]}W.namedEvents=O.uniq(W.namedEvents.concat(Q[Z]));return }if(W.hasOwnProperty(Z)){throw"Mixin error: class already has property '"+Z+"' defined"}W[Z]=Q[Z]},this)}};K.AttributesMixinCreator={create:function(R){var Q={};if(!R){R={}}if(!O.has(R,"id")){R.id=null}O.each(R,function(U,T){var V=K.Mixins.createMethodName("set",T);Q[V]=function(X,W){return this.set(T,X,W)};var S=K.Mixins.createMethodName("get",T);Q[S]=function(){return this.get(T)}});return Q},ensureType:B};K.EventsMixinCreator={create:function(R){var Q={};var S=function(U){var T=K.Mixins.createMethodName("on",U);Q[T]=function(){return this.on.apply(this,[U].concat(O.toArray(arguments)))};var V=K.Mixins.createMethodName("trigger",U);Q[V]=function(){return this.trigger.apply(this,[U].concat(O.toArray(arguments)))}};O.each(R,O.bind(S,this));return Q}};function D(R){return function Q(U,V){var W;var T=O.extend({},U);var S;if(U&&U.mixins){S=U.mixins;delete T.mixins}W=R.call(this,T,V);if(this.prototype.namedEvents){K.Mixins.applyMixin(W,{namedEvents:this.prototype.namedEvents})}if(this.prototype.namedAttributes){K.Mixins.applyMixin(W,{namedAttributes:this.prototype.namedAttributes})}if(S){O.each(U.mixins,function(X){K.Mixins.applyMixin(W,X)})}if(W.prototype.namedEvents){K.Mixins.applyMixin(W,K.EventsMixinCreator.create(W.prototype.namedEvents))}if(W.prototype.namedAttributes){W.prototype.namedAttributes=F(W.prototype.namedAttributes);K.Mixins.applyMixin(W,K.AttributesMixinCreator.create(W.prototype.namedAttributes))}if(W.prototype.toJSON){W.prototype.toJSON=A(W.prototype.toJSON)}W.extend=Q;return W}}function G(U,S){var T=U.prototype;var Q=S.prototype;var R=T.set;Q.set=function(a,b,Z){var Y,X=this.namedAttributes;if(!X||a==null){return R.apply(this,arguments)}if(O.isObject(a)){Y=O.clone(a);Z=b}else{Y={};Y[a]=b}for(var W in Y){if(!O.has(Y,W)){continue}if(!O.has(X,W)){throw"Attribute '"+W+"' does not exist"}Y[W]=B(X[W],Y[W])}return R.call(this,Y,Z)};var V=T.get;Q.get=function(W){if(this.namedAttributes&&!O.has(this.namedAttributes,W)){throw"Attribute '"+W+"' does not exist"}return V.apply(this,arguments)}}function C(Q){var S=Q.extend();var R=Q.extend;S.extend=D(R);return S}function J(Q){var R=C(Q);G(Q,R);return R}K.Model=J(N.Model);K.Collection=C(N.Collection);K.View=C(N.View);K.Router=C(N.Router)}());