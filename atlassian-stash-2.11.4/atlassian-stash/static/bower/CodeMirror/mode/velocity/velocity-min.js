CodeMirror.defineMode("velocity",function(){function D(N){var L={},M=N.split(" ");for(var K=0;K<M.length;++K){L[M[K]]=true}return L}var F=D("#end #else #break #stop #[[ #]] #{end} #{else} #{break} #{stop}");var E=D("#if #elseif #foreach #set #include #parse #macro #define #evaluate #{if} #{elseif} #{foreach} #{set} #{include} #{parse} #{macro} #{define} #{evaluate}");var H=D("$foreach.count $foreach.hasNext $foreach.first $foreach.last $foreach.topmost $foreach.parent.count $foreach.parent.hasNext $foreach.parent.first $foreach.parent.last $foreach.parent $velocityCount $!bodyContent $bodyContent");var B=/[+\-*&%=<>!?:\/|]/;function A(M,L,K){L.tokenize=K;return K(M,L)}function C(O,M){var L=M.beforeParams;M.beforeParams=false;var K=O.next();if((K=="'")&&M.inParams){M.lastTokenWasBuiltin=false;return A(O,M,J(K))}else{if((K=='"')){M.lastTokenWasBuiltin=false;if(M.inString){M.inString=false;return"string"}else{if(M.inParams){return A(O,M,J(K))}}}else{if(/[\[\]{}\(\),;\.]/.test(K)){if(K=="("&&L){M.inParams=true}else{if(K==")"){M.inParams=false;M.lastTokenWasBuiltin=true}}return null}else{if(/\d/.test(K)){M.lastTokenWasBuiltin=false;O.eatWhile(/[\w\.]/);return"number"}else{if(K=="#"&&O.eat("*")){M.lastTokenWasBuiltin=false;return A(O,M,G)}else{if(K=="#"&&O.match(/ *\[ *\[/)){M.lastTokenWasBuiltin=false;return A(O,M,I)}else{if(K=="#"&&O.eat("#")){M.lastTokenWasBuiltin=false;O.skipToEnd();return"comment"}else{if(K=="$"){O.eatWhile(/[\w\d\$_\.{}]/);if(H&&H.propertyIsEnumerable(O.current())){return"keyword"}else{M.lastTokenWasBuiltin=true;M.beforeParams=true;return"builtin"}}else{if(B.test(K)){M.lastTokenWasBuiltin=false;O.eatWhile(B);return"operator"}else{O.eatWhile(/[\w\$_{}@]/);var N=O.current();if(F&&F.propertyIsEnumerable(N)){return"keyword"}if(E&&E.propertyIsEnumerable(N)||(O.current().match(/^#@?[a-z0-9_]+ *$/i)&&O.peek()=="(")&&!(E&&E.propertyIsEnumerable(N.toLowerCase()))){M.beforeParams=true;M.lastTokenWasBuiltin=false;return"keyword"}if(M.inString){M.lastTokenWasBuiltin=false;return"string"}if(O.pos>N.length&&O.string.charAt(O.pos-N.length-1)=="."&&M.lastTokenWasBuiltin){return"builtin"}M.lastTokenWasBuiltin=false;return null}}}}}}}}}}function J(K){return function(P,N){var O=false,M,L=false;while((M=P.next())!=null){if((M==K)&&!O){L=true;break}if(K=='"'&&P.peek()=="$"&&!O){N.inString=true;L=true;break}O=!O&&M=="\\"}if(L){N.tokenize=C}return"string"}}function G(N,M){var K=false,L;while(L=N.next()){if(L=="#"&&K){M.tokenize=C;break}K=(L=="*")}return"comment"}function I(N,M){var K=0,L;while(L=N.next()){if(L=="#"&&K==2){M.tokenize=C;break}if(L=="]"){K++}else{if(L!=" "){K=0}}}return"meta"}return{startState:function(){return{tokenize:C,beforeParams:false,inParams:false,inString:false,lastTokenWasBuiltin:false}},token:function(L,K){if(L.eatSpace()){return null}return K.tokenize(L,K)},blockCommentStart:"#*",blockCommentEnd:"*#",lineComment:"##",fold:"velocity"}});CodeMirror.defineMIME("text/velocity","velocity");