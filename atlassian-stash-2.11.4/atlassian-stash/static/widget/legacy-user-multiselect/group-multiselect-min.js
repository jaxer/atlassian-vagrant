define("widget/group-multiselect",["aui","underscore","util/ajax","util/deprecation","widget/user-multiselect-commons"],function(C,D,G,F,E){function B(){return C.escapeHtml(stash_i18n("stash.web.group-multiselect.nomatch","No matching group found"))}function A(J,K,I){var L,H=this;this._initialGroups=K;this._$textfield=J;this._selectedGroups=[];var M=0;J.select2(L={ajax:{transport:function(N){var O=N.success;delete N.success;return G.rest.apply(G,arguments).done(O).done(function(){E.showNoResultsIfAllDisabled(B)})},url:I,data:function(N,O){return{filter:E.filterSearchTerm(N),start:O>1?M:0,limit:E.fetchLimit,avatarSize:E.avatarSize}},results:function(O,N){M=O.nextPageStart;O.values=D.chain(O.values).map(function(P){return{id:P.name,text:P.name,group:P}}).value();return{more:!O.isLastPage,results:O.values}}},formatSelection:function(N){return E.formatGroupSelection(N.group)},formatResult:function(N){return E.formatGroupResult(N.group)},initSelection:function(N,P){var O=[];D.each(H._initialGroups,function(Q){O.push({id:Q.name,text:Q.name,group:Q})});H._selectedGroups=O;P(O)},separator:"|!|",multiple:true,minimumInputLength:E.minimumInputLength,formatInputTooShort:E.formatInputTooShort,formatNoMatches:B,containerCssClass:E.containerCssClass,dropdownCssClass:E.dropdownCssClass,quietMillis:E.quietMillis}).on("change",D.bind(this.updateSelectedGroups,this))}A.prototype.getSelectedGroups=function(){return this._selectedGroups};A.prototype.clearSelected=function(){this._initialGroups=[];this._$textfield.auiSelect2("val",[])};A.prototype.updateSelectedGroups=function(H){if(H.removed){this._selectedGroups=D.reject(this._selectedGroups,function(I){return(I.id===H.removed.id)})}if(H.added){this._selectedGroups.push(H.added)}};return F.construct(A,"widget/group-multiselect","feature/user/group-multi-selector","2.5","3.0")});