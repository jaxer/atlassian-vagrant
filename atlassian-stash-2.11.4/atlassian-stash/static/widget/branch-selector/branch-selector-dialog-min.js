define("widget/branch-selector-dialog",["aui","jquery","widget/branch-selector","model/page-state","util/events","util/deprecation"],function(A,F,D,C,B,E){function G(L,P,Q){var O=this;var K={projectKey:C.getProject().getKey(),repoSlug:C.getRepository().getSlug(),branchesOnly:false,branchSelectorOpts:{}};var I=this.options=F.extend(true,{},K,Q);var J=this.branchSelector=new D(I.projectKey,I.repoSlug,I.branchSelectorOpts);var H=this.$button=F(L);var M=this.inlineDialog=A.InlineDialog(H,P,function(S,R,T){S.html(stash.widget.branchSelector({branchesOnly:I.branchesOnly}));S.addClass("branch-selector-contents");T();setTimeout(function(){J.init(S);J.populateBranchList();J.focusFilter()},0)},{hideDelay:null,width:270,hideCallback:function(){if(F(document.activeElement).closest(J._context).length){document.activeElement.blur()}F(document).add(M).off("keydown",N);B.trigger("stash.widget.branchselector.dialogHidden",this)},initCallback:function(){F(document).add(M).on("keydown",N);B.trigger("stash.widget.branchselector.dialogShown",this)},calculatePositions:function(S,V,d,R){var T=16,Y=8;var c=V.target.closest(".branch-selector-trigger"),U=c.offset(),Z=c.outerWidth(),a=c.outerHeight();var e=U.left,W=-Y+1,b=U.top+a+Y,X=(Z/2)-(T/2);return{displayAbove:false,popupCss:{left:e,top:b},arrowCss:{top:W,left:X}}}});function N(R){if(R.keyCode===F.ui.keyCode.ESCAPE){R.stopImmediatePropagation();M.hide()}}B.on("stash.widget.branchselector.revisionRefChanged",function(R){if(this===J){M.hide();H.focus()}});B.on("stash.widget.branchselector.repoChanged",function(){if(this===J){M.hide();O.clearSelection()}})}G.prototype.updateSelectedRevisionReference=function(H){if(H){this.$button.attr("title",H.getTypeName()+": "+H.getDisplayId());this.$button.find(".ref-type-icon").toggleClass("aui-iconfont-devtools-branch",H.isBranch()).toggleClass("aui-iconfont-devtools-tag",H.isTag());this.$button.find(".ref-name").text(H.getDisplayId())}else{this.clearSelection()}};G.prototype.clearSelection=function(){this.$button.attr("title","");this.$button.removeClass("aui-iconfont-devtools-tag").addClass("aui-iconfont-devtools-branch");this.$button.find(".ref-name").text(stash_i18n("stash.web.branchselector.default","Select Branch"))};return E.construct(G,"widget/branch-selector-dialog","feature/repository/revision-reference-selector or feature/repository/branch-selector","2.4","3.0")});