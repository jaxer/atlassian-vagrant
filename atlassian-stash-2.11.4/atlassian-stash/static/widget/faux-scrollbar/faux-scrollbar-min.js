define("widget/faux-scrollbar",["jquery","underscore","util/dom-event","util/events","util/function"],function(F,C,A,D,E){function B(){this._scroller=document.createElement("div");this._scrollee=document.createElement("div");this._scroller.appendChild(this._scrollee);this._scroller.className="faux-scrollbar";this._scrollee.className="scrollee";this._scrollerHeight=17;if(F.browser.msie){this._scroller.style.height="18px"}document.body.appendChild(this._scroller);this._userActivatedScroll=true;this._firstInit=true;this._contentWidth=0}B.prototype._onFirstInit=function(){var J=this;this._scroller.onscroll=function(){if(J._userActivatedScroll){J._userActivatedScroll=false;J._puppet.scrollLeft=J._scroller.scrollLeft*J._scrollLeftRatio}else{J._userActivatedScroll=true}};var M=false;var I=16,K=37,H=39;F(document).on("keydown.fauxscrollbar",function(Q){var P=Q.keyCode,R=C.any([H,K],E.eq(P));if(R&&!A.modifiersPreventScroll(Q)){var O=Q.target,S=O&&/INPUT|SELECT|TEXTAREA/i.test(O.tagName);if(!S){if(P===H){J._scroller.scrollLeft+=40}else{if(P===K){J._scroller.scrollLeft-=40}}}}else{if(P===I){M=true}}});F(document).on("keyup.fauxscrollbar",function(O){if(O.keyCode===I){M=false}});var N=F.browser.mozilla;var L=F.browser.webkit&&(/Chrome/).test(navigator.userAgent);if(N){F(document).on("DOMMouseScroll.fauxscrollbar",function(P){P=P.originalEvent;var O=M||(P.axis===P.HORIZONTAL_AXIS)?P.detail:0;if(O){J._scroller.scrollLeft+=O*100}})}else{F(document).on("mousewheel.fauxscrollbar",function(P){P=P.originalEvent;var Q=P.wheelDeltaX||(M&&P.wheelDelta)||0,O=(Q/120)||(M&&P.detail);if(O){if(L&&P.webkitDirectionInvertedFromDevice){O=-O}J._scroller.scrollLeft-=O*100}})}F(window).on("resize.fauxscrollbar",function(){J._hideIfAbovePuppet();J._setContentWidthIfKnown();J._updateContainerWidths();J._updateScrollLeftRatio()}).on("scroll.fauxscrollbar",function(){J._hideIfAbovePuppet()})};B.prototype.init=function(I,J){var H=this;if(this._firstInit){this._onFirstInit();this._firstInit=false}if(this._puppet){F(this._puppet).off(".fauxscrollbar")}this._puppet=I;this._contentWidth=0;this._setContentWidthIfKnown(true);if(J){this.setOptions(J)}else{this._updateContainerWidths();this._updateScrollLeftRatio()}F(this._puppet).on("scroll.fauxscrollbar",function(){if(H._userActivatedScroll){H._userActivatedScroll=false;H._scroller.scrollLeft=H._puppet.scrollLeft/H._scrollLeftRatio}else{H._userActivatedScroll=true}}).scroll();H._userActivatedScroll=true};var G=["top","left","bottom","right"];B.prototype.setOptions=function(H){var I=F(this._scroller);var J=C.some(G,C.bind(C.has,C,H));if(J){C.each(G,function(K){I.css(K,H[K]!=null?H[K]:"auto")})}if(C.has(H,"hideAbove")){this._hideAbove=H.hideAbove}this._updateContainerWidths();this._updateScrollLeftRatio()};B.prototype.setPosition=B.prototype.setOptions;B.prototype.destroy=function(){F(document).off(".fauxscrollbar");F(window).off(".fauxscrollbar");if(this._puppet){F(this._puppet).off(".fauxscrollbar")}this._scroller.onscroll=null;this._scroller.parentNode.removeChild(this._scroller);this._puppet=this._scroller=this._scrollee=null};B.prototype._setContentWidthIfKnown=function(I){var J,H;var K=this._contentIsClipped;if(I||!K){this._contentIsClipped=(J=this._puppet.clientWidth)&&(H=this._puppet.scrollWidth)>J;if(this._contentIsClipped){H=H||this._puppet.scrollWidth;this._contentWidth=H;return true}else{if(I){this._contentWidth=0;return false}}}return this._contentIsClipped};B.prototype._updateScrollLeftRatio=function(){this._scrollLeftRatio=(this._contentWidth-this._puppetWidth)/(this._scrolleeWidth-this._scrollerWidth)};B.prototype._updateContainerWidths=function(){this._scrollerWidth=this._scroller.clientWidth||this._scroller.offsetWidth;this._puppetWidth=this._puppet.clientWidth||(this._contentWidth+1);this._scrolleeWidth=Math.round(this._contentWidth*this._scrollerWidth/this._puppetWidth);this._scrollee.style.width=this._scrolleeWidth+"px";D.trigger("stash.widget.faux.scrollbar.visibilityChanged",null,(this._scrolleeWidth>=this._scrollerWidth))};B.prototype._hideIfAbovePuppet=function(){if(this._hideAbove===false){return }var K=F(window),I=F(this._puppet),J=F(this._scroller);var H=K.scrollTop()+K.height()<(this._hideAbove||I.offset().top)+this._scrollerHeight;if(H!==this._isHidden){this._isHidden=H;J.toggleClass("hidden",H);if(!H){this._setContentWidthIfKnown();this._updateContainerWidths();this._updateScrollLeftRatio()}}};B.prototype.getScrollLeft=function(){return this._scroller.scrollLeft};B.prototype.setScrollLeft=function(H){this._userActivatedScroll=true;this._scroller.scrollLeft=H};B.prototype.isShowing=function(){return this._scroller.scrollWidth>this._scroller.clientWidth};return B});