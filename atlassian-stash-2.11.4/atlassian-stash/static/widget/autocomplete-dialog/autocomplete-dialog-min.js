define("widget/autocomplete-dialog",["backbone","jquery","underscore"],function(D,B,A){var C=(B.browser.msie&&parseInt(B.browser.version,10)===8);return D.View.extend({className:"aui-dropdown2 aui-style-default"+(!C?" aui-dropdown2-tailed":""),initialize:function(){var E=parseInt(this.options.minZIndex,10);if(E){this.$el.css("z-index",E+1)}B(document.body).append(this.el);if(this.options.anchor){this.updateAnchorPosition(this.options.anchor)}this.template=this.options.template||B.noop;this.highlighter=this.options.highlighter;this.collection=this.collection||new D.Collection();this.collection.bind("reset",this.render,this);this.render()},events:{"click li.result":"onClickItem"},render:function(){var G=this.collection.toJSON(),H=this.collection.query,F=this.collection.indexOf(this.selectedResult);var E=B(this.template({query:H,results:G,activeItemIndex:(F>=0)?F:0}));if(H&&G.length&&A.isFunction(this.highlighter)){E=this.highlighter(E,H)}this.$el.html(E);if(this.$spinner){this.$spinner.appendTo(this.$("ul"))}return this},toggleSpinner:function(E){if(E){if(!this.$spinner){this.$spinner=B("<li/>").addClass("spinContainer").appendTo(this.$("ul")).spin("small")}}else{this.$spinner&&this.$spinner.spinStop().remove();this.$spinner=null}},moveSelectionUp:function(){this.moveSelection(this.DIRECTION_UP)},moveSelectionDown:function(){this.moveSelection(this.DIRECTION_DOWN)},moveSelection:function(H){var I=this.$("li");if(I.length<=1){return }var G=I.filter(".active"),E=B.inArray(G.get(0),I),F="active";if((H===this.DIRECTION_DOWN)?(E<I.length-1):(E>0)){E=E+H;I.removeClass(F).eq(E).addClass(F);this.selectedResult=this.collection.at(E)}},getSelectedItemIndex:function(){return this.$("li.active").index()},onClickItem:function(E){this.trigger("itemSelected",this.$(E.currentTarget).index())},anchorOptions:{dropdownTailBufferLeft:25,dropdownTailBufferRight:35,viewportWidth:B(window).width(),bufferTop:!C?2:5},updateAnchorPosition:function(E){if(this.anchorOptions.viewportWidth-E.left>this.$el.outerWidth()){this.$el.css({top:E.top+this.anchorOptions.bufferTop,left:E.left-this.anchorOptions.dropdownTailBufferLeft}).attr("data-dropdown2-alignment","left")}else{this.$el.css({top:E.top+this.anchorOptions.bufferTop,left:E.left-this.$el.outerWidth()+this.anchorOptions.dropdownTailBufferRight}).attr("data-dropdown2-alignment","right")}},DIRECTION_UP:-1,DIRECTION_DOWN:1})});