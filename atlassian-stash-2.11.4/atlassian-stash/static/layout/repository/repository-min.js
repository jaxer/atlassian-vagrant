define("layout/repository",["jquery","aui","util/events","util/navbuilder","model/page-state","model/repository","feature/repository/sticky-branches","widget/quick-copy-text","exports"],function(F,N,Q,G,M,I,C,E,D){function P(S){var R=new I(S);M.setRepository(R);M.setProject(R.getProject())}function L(){return F(".clone-url")}function O(){return F(".repository-protocol")}function K(){var Y=L(),T=Y.find("input"),W=O(),S=F("#"+W.attr("aria-owns")),V=S.find("li"),X,R,U="";if(W.is("button")){H(W,W.text());X=W.attr("data-clone-url");R=W.attr("data-module-key")}else{H(W,V.first().children("a").text());X=V.first().attr("data-clone-url");R=V.first().attr("data-module-key")}T.val(X);Y.addClass(R);U=R;V.on("click",function(Z){var a=F(this);H(W,a.text());T.val(a.attr("data-clone-url")).select();R=a.attr("data-module-key");Y.removeClass(U).addClass(R);U=R;Q.trigger("stash.feature.repository.clone.protocol.changed",null,R,a.attr("data-clone-url"));Z.stopPropagation();if(S.is(":visible")){W.trigger("aui-button-invoke")}Z.preventDefault()});Q.trigger("stash.feature.repository.clone.protocol.initial",null,R,X)}function H(S,T){var R=S.children("span").remove();S.text(T).append(R)}function B(S,U){var V=F(S);var R=F(U);var T=N.InlineDialog(V,"clone-repo-dialog",function(X,W,Y){X.append(R);Y();_.defer(function(){R.find(".clone-url input").select()})},{width:360,offsetY:7,hideCallback:function(){var X=O(),W=F("#"+X.attr("aria-owns"));if(W.is(":visible")){X.trigger("aui-button-invoke")}}});F(document).keyup(function(W){if(W.keyCode===F.ui.keyCode.ESCAPE){T.hide()}});R.find("a.sourcetree-clone-button").on("click",function(){T.hide()})}function A(){var R=F(".aui-page-header-actions .create-pull-request");Q.on("stash.layout.branch.revisionRefChanged",function(T){var S=G.currentRepo().createPullRequest();if(!T.isDefault()&&T.isBranch()){S=S.sourceBranch(T.getId())}R.attr("href",S.build())})}function J(){F(".repository-badge .badge").tooltip({gravity:"n"})}D.onReady=function(T,R,S){P(T);K();E.onReady();C.onReady();B(R,S);A();J()}});