define("page/repository/emptyRepository",["jquery","aui","model/page-state","util/ajax","util/events","exports"],function(G,B,E,F,D,A){function C(H,I){G("#empty-repository-instructions").html(stash.page.emptyRepositoryInstructions({repository:E.getRepository().toJSON(),cloneUrl:I,currentUser:E.getCurrentUser().toJSON()}))}D.on("stash.feature.repository.clone.protocol.initial",C);D.on("stash.feature.repository.clone.protocol.changed",C);A.onReady=function(L){if(G("#empty-repository-instructions:empty").length){C(null,E.getRepository().getCloneUrl())}if(L){var M="/browse",K=window.location.href.lastIndexOf(M),H=K===-1?window.location.href:window.location.href.substr(0,K);var O=G('<div id="initialising" />'),N=G("<h2></h2>"),I=G("#content .content-body");N.text(stash_i18n("stash.web.repository.initialising","Initialising your repository"));var J=G.browser.msie&&parseInt(G.browser.version,10)<9?I.find("pre").andBack():I;J.css("opacity",0.2);N.appendTo(O);O.appendTo(I.parent());O.spin("large");F.poll({url:H,tick:function(Q){var P=Q&&Q.state;if(P==="AVAILABLE"){return true}else{if(P==="INITIALISATION_FAILED"){return false}else{return undefined}}}}).always(function(){O.spinStop();O.remove();J.fadeTo("fast",1)}).fail(function(S,R,P,Q){I.empty().css("padding","16px");if(S.status===200){G(widget.aui.message.error({content:B.escapeHtml(Q.statusMessage)})).appendTo(I)}})}}});require("page/repository/emptyRepository");