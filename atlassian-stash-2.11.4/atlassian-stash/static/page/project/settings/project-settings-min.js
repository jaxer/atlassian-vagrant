define("page/project/settings",["aui","jquery","model/page-state","util/ajax","util/flash-notifications","util/navbuilder","widget/confirm-dialog","feature/project/project-avatar-picker","exports"],function(H,C,G,F,D,A,I,E,B){B.initDeleteButton=function(Q){var P=C("<div class='container'></div>"),L;var M=new I({id:"delete-project-dialog",titleText:stash_i18n("stash.web.project.delete","Delete project"),titleClass:"warning-header",confirmButtonClass:"delete-confirm-button",panelContent:P,submitText:stash_i18n("stash.web.button.delete","Delete")},{type:"DELETE"});function O(){P.empty();L=C("<div class='spinner'></div>").appendTo(P)}function N(R){if(R){C(".delete-confirm-button").removeProp("disabled").removeClass("disabled")}else{C(".delete-confirm-button").prop("disabled","disabled").addClass("disabled")}}function K(){var R=C("<p>").html(stash_i18n("stash.web.project.delete.confirm","Are you sure that you want to delete {0}?","<b>"+H.escapeHtml(G.getProject().getName())+"</b>"));var S=C("<p>").html(stash_i18n("stash.web.project.delete.confirm.detail","Deleting cannot be undone and this project will be permanently removed."));C.merge(R,S);P.append(R);N(true)}function J(){var R=C("<p>").html(stash_i18n("stash.web.project.delete.unable","The project {0} cannot be deleted.","<b>"+H.escapeHtml(G.getProject().getName())+"</b>"));var S=C("<p>").html(stash_i18n("stash.web.project.delete.unable.detail","All repositories must be removed from this project before it can be deleted."));C.merge(R,S);P.append(R);N(false)}M.attachTo(Q,function(){O();N(false);L.spin("large");F.rest({url:A.rest().currentProject().allRepos().build(),statusCode:{"*":function(){return false}}}).done(function(R){if(R&&R.size){J()}else{K()}}).fail(function(){K()}).always(function(){L.spinStop().remove()})});M.addConfirmListener(function(R){R.done(function(S){D.addNotification(stash_i18n("stash.web.project.deleted","The project {0} has been deleted.",G.getProject().getName()));window.location=A.allProjects().build()})})};B.onReady=function(){new E(".avatar-picker-field")}});