define("page/project/permissions/project-permissions-model",["underscore","backbone-brace","util/ajax","util/navbuilder"],function(C,D,E,F){var B=D.Model.extend({namedAttributes:{grantedDefaultPermission:"string",publicAccess:"boolean"},getEffectiveDefaultPermission:function(){return this.getPublicAccess()&&this.getGrantedDefaultPermission()===B.NONE?B.READ:this.getGrantedDefaultPermission()},savePublicAccess:function(H){var G=this.getPublicAccess();this.setPublicAccess(H);return B._sendSavePublicAccessRequest(H).fail(C.bind(function(){this.setPublicAccess(G)},this))},saveDefaultPermission:function(G){var I=B.unpackPermission(G);var H=this;var J=this.getGrantedDefaultPermission();this.setGrantedDefaultPermission(G);return B._sendSavePermissionRequest(A().projectRead().all(),I.read).then(function(){return B._sendSavePermissionRequest(A().projectWrite().all(),I.write).fail(function(){var K=B.unpackPermission(J).write;I.write=K;H.setGrantedDefaultPermission(B.packPermission(I))})},function(){H.setGrantedDefaultPermission(J)})}},{WRITE:"write",READ:"read",NONE:"none",unpackPermission:function(G){return{read:G===B.WRITE||G===B.READ,write:G===B.WRITE}},packPermission:function(G){return G.write?B.WRITE:G.read?B.READ:B.NONE},_sendSavePermissionRequest:function(G,H){return E.rest({type:"POST",url:G.allow(H).build()})},_sendSavePublicAccessRequest:function(G){return E.rest({type:"PUT",url:F.rest().currentProject().build(),data:{"public":G}})}});function A(){return F.rest().currentProject().permissions()}return B});