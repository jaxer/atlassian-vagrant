define("util/promise",["jquery","underscore","exports"],function(F,L,D){function C(O){O&&O.abort&&O.abort()}function H(){var O=Array.prototype.slice.call(arguments);var P=F.when.apply(F,O);P.abort=function(){L.forEach(O,C)};return P}function J(){console.log("Promise does not have an abort function")}function B(){var O=F.when.apply(F,arguments);O.abort=L.invoke.bind(L,arguments,"abort");return M(O)}function M(X,Q,P){var O;var W=X;var S=F.Callbacks();var T={};function U(){if(T.state()==="pending"){if(!O){C(W)}O=true}S.fire()}function V(Y,Z){return function(){if(O){return new F.Deferred()[Y+"With"](this,arguments)}W=Z.apply(this,arguments);return W}}var R=X.then(Q?V("resolve",Q):null,P?V("reject",P):null);T.abort=U;T.thenAbortable=function(Y,a){var Z=M(T,Y,a);S.add(Z.abort);return Z};return R.promise(T)}function E(P,O){return function(){var U=F.Deferred();var Q=this;var R=Array.prototype.slice.call(arguments);var V;var T=function(){return setTimeout(function(){var W=P.apply(Q,R);W.done(U.resolve).fail(U.reject);V=W.abort?L.bind(W.abort,W):J},O)};var S=T();V=function(){clearTimeout(S);U.reject(U,"abort","abort")};return U.promise({abort:function(){V()},reset:function(){if(U.state()==="pending"){clearTimeout(S);R=Array.prototype.slice.call(arguments);S=T()}}})}}function G(){return F.when.apply(F,L.map(arguments,A)).then(I,I)}function A(O){return O.then(N(false),N(true))}function N(O){return function(){return F.Deferred().resolve({rejectedSelf:O&&this,self:this,args:Array.prototype.slice.call(arguments)})}}function I(){var R=L.chain(arguments).pluck("rejectedSelf").find(L.identity).value();var Q=(R?"reject":"resolve")+"With";var O=R||arguments[0].self;var P=L.pluck(arguments,"args");return F.Deferred()[Q](O,P)}function K(O,R,P){var Q=F(O).spin(P||"small");return R.always(function(){Q.remove()})}D.delay=E;D.reduce=H;D.settle=G;D.spinner=K;D.thenAbortable=M;D.whenAbortable=B});