define("util/performance",["jquery"],function(D){function F(I,L){var G=new D.Callbacks();var H=false;var J=null;function K(){J=null;H=true;G.fire();G=new D.Callbacks();H=false;L()}return{name:I,forceExecute:function(){if(J){clearTimeout(J);K()}},queue:function(M){if(H){M()}else{G.add(M);if(!J){J=setTimeout(K,0)}}}}}var A=F("READ",function(){C.forceExecute()});var C=F("WRITE",function(){A.forceExecute()});function B(G,J,I){I=I||1;var K=0;return function H(){if(K>=I){return }K++;G(function L(){try{return J.apply(this,arguments)}finally{K--}})}}function E(I,G,H){G=D.extend({initial:500,min:10,max:Infinity},G);H=H||function(K){K()};function J(K){return Math.min(G.max,Math.max(G.min,K))}return function(K){var P=G.initial;var M=D.Deferred();var O=0;var N=[];function Q(){for(var R=Math.min(O+P,K.length);O<R;O++){N[O]=I(K[O])}}requestAnimationFrame(function L(){if(M.state()!=="pending"){return }var T=new Date().getTime();H(Q);var R=new Date().getTime();var S=R-T;P=J(Math.ceil(P*(15/S)));if(O===K.length){M.resolve(N)}else{requestAnimationFrame(L)}});return M}}return{queueDOMRead:A.queue.bind(A),queueDOMWrite:C.queue.bind(C),enqueueCapped:B,frameBatchedMap:E}});