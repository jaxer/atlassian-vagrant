define("util/oauth",["jquery","util/events"],function(E,B){var A=(function(){function I(){if(window.aouthWindow&&window.aouthWindow.close){window.aouthWindow.close()}window.oauthCallback=null;window.aouthWindow=null}function H(L,M,K){window.oauthCallback={uri:L,success:function(){I();if(M){M()}},failure:function(){I();if(K){K()}}};window.aouthWindow=window.open(L)}function J(K){if(window.oauthCallback&&window.oauthCallback.uri===K){window.oauthCallback.failure()}}return{fireRequest:H,cancelRequest:J}}());function D(J){var H=new E.Deferred();var K={url:J,deferred:H,api:H.promise({abort:function(){A.cancelRequest(J)}})};B.trigger("stash.util.oauth.authorizationRequested",null,J);H.then(function L(){B.trigger("stash.util.oauth.authorizationSucceeded",null,J)},function I(){B.trigger("stash.util.oauth.authorizationFailed",null,J)});A.fireRequest(J,H.resolve,H.reject);return K}var C;function G(H){if(C){if(C.url===H){return C.api}C.api.abort()}C=D(H);var I=C;C.deferred.always(function(){C=null});return I.api}function F(H){E(document).on("click",H,function(J){var I=this.getAttribute("href");if(I){G(I);J.preventDefault()}})}return{authorizeUrl:G,interceptLinks:F}});